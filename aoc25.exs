defmodule AOC25 do
  def parse(input) do
    lines = String.split(input, "\n")
    col_cnt = byte_size(Enum.at(lines, 0))
    data = Enum.join(lines)
    |> String.to_charlist()
    |> Enum.reduce({%{}, 0}, fn x, {map, flat_idx} ->
      idx = from_flat_index(flat_idx, col_cnt)
      {Map.put(map, idx, x), flat_idx + 1}
    end)
    |> elem(0)
  end

  def from_flat_index(idx, col_cnt) do
    {Integer.mod(idx, col_cnt), div(idx, col_cnt)}
  end

  def visualize(map) do
    x_range = elem(elem(Enum.max_by(map, fn {{x,_y}, _value} -> x end), 0), 0)
    y_range = div(map_size(map), x_range) - 2

    IO.write(IO.ANSI.cursor(0,0))

    {:ok, pid} = StringIO.open("")

    for y <- 0..y_range do
      for x <- 0..x_range do
        IO.write(pid, [map[{x,y}]])
      end
      IO.write(pid, "\n")
    end

    IO.puts(StringIO.flush(pid))
    StringIO.close(pid)

    map
  end

  def simulate(map, num_steps \\ 1) do
    new_map = move_east(map)
    |> move_south()
    |> visualize()
    if map == new_map, do: {map, num_steps}, else: simulate(new_map, num_steps + 1)
  end

  def move_east(map) do
    changes = Enum.reduce(map, %{}, fn
      {pos, ?>}, change_map -> move_east(map, change_map, pos)
      _, change_map -> change_map
    end)
    #IO.inspect(changes, label: "MAP CHANGES")
    Map.merge(map, changes)
  end

  def move_east(map, change_map, {x, y} = pos) do
    neighbor = {x+1, y}
    case Map.fetch(map, neighbor) do
      {_pos, ?.} ->
        Map.put(change_map, neighbor, ?>)
        |> Map.put(pos, ?.)
      {_pos, _} ->
        change_map

      :error ->
        neighbor = {0, y}
        case Map.fetch(map, neighbor) do
          {_pos, ?.} ->
            Map.put(change_map, neighbor, ?>)
            |> Map.put(pos, ?.)
          {_pos, _} -> change_map
        end
      end
  end

  def move_south(map) do
    changes = Enum.reduce(map, %{}, fn
      {pos, ?v}, change_map -> move_south(map, change_map, pos)
      _, change_map -> change_map
    end)
    #IO.inspect(changes, label: "MAP CHANGES")
    Map.merge(map, changes)
  end

  def move_south(map, change_map, {x, y} = pos) do
    neighbor = {x, y+1}
    case Map.fetch(map, neighbor) do
      {_pos, ?.} ->
        Map.put(change_map, neighbor, ?v)
        |> Map.put(pos, ?.)
      {_pos, _} ->
        change_map

      :error ->
        neighbor = {x, 0}
        case Map.fetch(map, neighbor) do
          {_pos, ?.} ->
            Map.put(change_map, neighbor, ?v)
            |> Map.put(pos, ?.)
          {_pos, _} -> change_map
        end
      end
  end

  def solve(input) do
    {final_map, step_count} = parse(input)
    |> visualize()
    |> simulate()
    visualize(final_map)
    step_count
  end
end

input = "v...>>.vv>
.vv>>.vv..
>>.>v>...v
>>v>>.>.v.
v>v.vv.v..
>.>>..v...
.vv..>.>v.
v.v..>>v.v
....v..v.>"

full_input = "v..vv..v>>>>.>v.v.v.>vv...>vv.v.v>v..v>.v.>....>vv..>.>>..v>..v.vv>v>.>v.v..>.v..>..>v........v.v.>v>v...v...>.>.>>...>>.>v.v..>..vv.>..>vv
>..v>v.v>....vv>.>>.v.>v>v>>..v>>..v>.v..v>vv.>..vv.v..>vv>v>.v...v>...v.vv.vv>.>v>..>.>.>..>.>v..>v>>.vv..>v....>vvv.v.v>.>>.v...>v.vv.v..
v..>.vv..>>....vv..v>..v..v>>v..>>>.v.>>....vv.>.v>v...v>v>..v>....>....>.v.>vv>.>..v...v.vv>>>>.vv>vv>.>>..v>..>>...>..v...>vv>v...v.>....
...>.v.v.>...v...>.>>>...v.v>v>vv...>..v..vv...>.v..vv.>.>>.>.v...>v>..v..vvvv.>>.>.v.v>...>vv.v..>v>>v.>......vv.v.v...>.>.v..>.vvv...>..>
..vv>>>.......>.v.>.......>>..v>......vv..v......v>vv.>...>...v....>>v>v.......v>>.v.>v.>.>.v.>vv.v>>>.>..v>v.v.v.>>..>.>.>v..>v.>>....>.>.
.>.>..>..vvv....v...>.v...vv.>.>.>.v>..v.v>.>>>>..>....>..v>vvv>.>v>v.>v.v..v..v>v>.v.v>>....vvv>..vv.vv.>..v>v>>...>.>.v>v..v>>vv....vv.v.
>>.vv>..vv...v>.v..v.>.v..vv>..v.>>vv>..>.>..v..vv>>.v>....>.v.>>vv.>>vvv.v>.>>v.v>>v.v.v.v.v>v>>.>v>...vv.....v.>v.>>v>..v.v.>.v.>...>...>
.>..>..>.vv...v.>>..>>v.>v.>>...>.....v...>>...v>..vvv..>v.v>...v...>>>v.>..>>>.vv>.vv.>.>.>>>>..v>....vv>.....>v>>>..>.>v>.........>v>.>>v
.>.v.>..>>>..>.vvv.vv.....>v.>........>>....>..>>.vv..>>v>..>.....>......>........v.>vv>.>.v>>.v.>...>>>>..>>....v....vv>.>...........v....
>>v>.v>.v.....vv....>>..>>.vvv..v>v>..>.v.v..v.vv.....>>v>>.>>...>.v>>v..>>>>v.v.>vv>.>>.>.>>vv>..>v>..>vvv>>>..v....>>...>....>.v>>..v>.>.
>...>....>v>.>>>.>..v..>..>...>>>v>.v.....>vv.v>.....>vv..vv>>.v.vv.v..v>..v..v..v.>v.>.vv>..vv.v...v...v.>>.v>..vv>>v>.v.v.......vv..v..v>
>>.>v...v>.>v..v>>..>>..>.v>vv..v..>vv...>...>....>...>.v....v.>.>>v....vv>.>.v.v>.>.>v..v.>>.v..>>v...>.>>........>..>.>vvv>.v.....>v.>v.v
>v>.>v....>>>..>>.v>..v.v..vv>v.v..>v.>>>..>.>.>.....vv.>..v>v.v>.>.v..v...>.v>vv.>>>..>.>....>....v>v..>....v>v..>..vvv>...>.>..v>>v.v.>v>
....v.v.>>.>...v...>vvv>.vv.>.v>....v...>vv..>>v>>v..>.....>>..>.>......>>v>.........v>v.v...v.v.>...v>v..v.v>..v...v>..>>..v.>>>.>v.>.>>..
.v>.>.....v..>v.>.>.v>>.>>>..vv>.>vv.>v>>vv>>vvv..v>v>v.v>.v.>v...v..>..>.>.v...>.>...v.>vv.v.>...>>v..>v...>>..>..>.>v..v>.........>v..>.v
vv>..v>...>>.v.>>>..>..v...>>....>..v>v.>>v..v>..v>.>>>.>vv..vvv>.>.v>v>v.v.........>v....>.v.....>>..v.>>.v.v...v>...v>v..vv.v..>>..>v.vv.
>.v.v>.v>..>.vv.>.>.>.>>>......v>>..v.v>....vvv>>>.>v>>...>>vv>vv>.>..>>v>...>>...>..v.v.vv>>v.>vv.v...v.vv>..v>.>..v...>.>v.v.>.>>v>>>>>v.
.v>v>v...>>>>.v...>>vv>>v>...v.>v.vvv>v>...v.>.v...v....>.v.v.v.v>vv..>..v>.vv....>vv>v..v..v....vv>vv>v>>v>>...v..vv.>.v.v.>vv>...vv>>v...
....v.v.>v.v>v...>..>vv.>.>>>v...v..v.vv.v.>vv....v.v>.v>...v..>>...vv>..v>v>.....v.v.vv>.>v.vv.v.vv..v.v..>.v>>..v>.v.>>vv.vvvv.v>.>>>>v>>
vv>v...v>>..v>v...v.>.>.>.>..>.>v....>v...>.v>.>..>>.vv...vv.vvv>v>.....v..v.>v..>>.v.>....>.>>.v>v.v>>....v.>...v.v..vv..v.>v>>.v...>.v.>>
v>>>.....>>.v>v.v>..v>..>...>>.v..>v...v.v>>...v..v.>>.>vv.v.>.>>..>..>.>v>v.>..>.v.v>.v..>>v.>.>..vv.vvv..>...v>...>...v.>.v>.v.v..v..>>v.
>v.vv.v...v.>v...>..>>.>>..>.v.v.v....v.v....>..v.>>.>....v.>>..>>>....v..v.v>..>v.>v.v..>.v..v...>.vv.vv>.vv..v..v.>vv.>..v>>v..>.........
.v>.>.v...v.>.>.vvvv...>.>v.>..>.vv.vv>..v>>v...v.v.>v>>.v>....>..v..v.>v.>..v>vvv>.>.v.v...>.v....v....>>v..>>v.v>>.v..>..>>.v..>.v..vv>.v
>vv.vv>vv.vvvv.vvv>.v>...v.v>>..>v.>>.>..>>.>..v.v..>>v.v.v..>.>>>v..v>>...v>v.>>.vv.v>vv>.v.vv.v>v.....vv......>v.>.>.>..>.>..>>.v.>.v>...
v.>.>....v.>>>.....>v..vv>>>v>v>v>v.>vv.>v.>.v.>v.v.v>.v..........v>v>..v..>>..>v.vv>.vvv>v....>>..>>vv>.>v.v...>.>.>.>>.....vv.>.>>v..v...
vvv..>>....v..v.>..v>......v....>.>.v.>vv>>v...v.>>v..>>v...>..>>.>>.v.v.v>.v>...v.vv.>.>v....>>..>v...v>.vv.>.vv..v>.>..>>..v...vv...>.>.v
v.v>.vv.>v.v.vv>..>>..v.......v>>.>.v.....v.vv.vv>v.....v...>vv..vv..v.>>.....vv......>>v......>>vv>vv.v......v....>..>.......>>.v>v.>.v>..
.v...>v.>v....>.>.....>.>>>..>...v.>v>>.>>.>...v.>.v>.....vv..vv...v..vv...>...vv.v>..vv>.vv.v.>..............vv...>....>...>.....>v.....>.
>.v.>.>.>v.>..v.v.>>..>.>>v..>>.>.>.....>>.>...v.>>v>v>v.>>..v>>v>v....vv..v.v.vv>.v..v..vv...v>.>>..v>>...>..vv>>...v.>v..v...>..v.v>...>>
.v>.vv.v>vv>.>>.v...v...v...v.>.v......v>v.vv...v.v>v..>..>..v>v..>v>v>...>...>..>..>.>v..v>v.v.>..v>>....>>....vv>>.>.v.>.....v>.>...>.>v>
.>.v..vv>.vvvvv>v.vv>v.>v......>>>.v>vv.v.....v..v>vvv..v.v.v.v>......v..>.>...>>>.v.vvvv..v.>..>..>.v...v.vv.vv>vvv.vv>.v.v.v>..v.>v>>v>>.
>vv....>...v..vv.....v...>vvv..>>.....v.vvv>>>v..v.v.>v.v.....v>..v>>>.>.>>.>...v>>>>.v..v....v>v..vv>v.>.>v.v.......v>.....v.>..>.v>vv>.vv
v..>..vv.>vv>>>...vv....>>>vv>>v>.v..v.....>vv.v...v....v.v.>>>.>v..vv..>...v>..v.v>.vv.v...v.vv..v.>>.>.v.....>>v..>..>.>v.>>>.>.v.vvvv>v.
.>v>>...>v.>...>...>v....>>v.v.v>.v.vv..v....>v>.v.>......v>..>vv>..v>....>>v>>vv>v..v>v.>v>...v.>.>...v....>..v.>>..v>>..>>vvv..v>>v.v>v..
....>.vv.....vv.>.v>vv..>>>v>>v>.v..v..>..v....v.v.>..>....>v....>>>.v.>.>..v>vv.....v>...>..>.>v>....>.vv.>>..v......>..vv.....v.>>..>v.>>
>.v..>v..v...v.>>v.v.v>v>v..v>>v>.....>.>>v......>.>>>>v.v..v..v...>v>.v>>.>>...>vv.v>.>v..>vvv...>....>>..>.>.>>...>...v>.>.>.....>>..vv..
v.v.>....>v>v.vv..>.>>..v>vv>>v.v.v>.v.v.>...>.>>v..>.v.>vv.vv.vv.>..>v>.>..>..v..>v>...v....>.vv.v>vv>.v..>....v.v>v.v....v>.>....v..v>..>
>.vv>...vv>>....>..v>...>..>.v>..>>v.>.>>....>>>.v.vvvv.>..>.>.>...v...v>...>...v..>.>vv..>v...>..v.v....v>..v>v>.v.>.>v.>.>>..v..>.vv..>v>
>.v>v.>.>vv..v>.v>v....v.>>v>v...>>.v>.v.>.>..>v.vvv.vv...>.v..v..vvv..v>vv...v>...v>v.v.v>.v..vv.>v..>v>vv....>..v>v....>......vvvv..>v...
v....v......v..vv>v.>.v>.v..v.>>>..v.>......>vv>>>.v>.>v..v.>..vv..v>..v..vvv....>...>..v..v>..>v..v..>v>>.v.vvvv.>vv>..v>.>>..v....v>....>
>vv.v>...>.>v..v..v..>vv..>v...v.v.>v>>.v.v...v.v>....vv.......vv..>>>.vvv>>>...v.v>v.>.>..>.v.v.v.vv.>.vvv...>..>...v..v...>v.>v.>>..vv..>
v..>...>>v>...v.....v...v>v>v.>v.v>>v>>>v.v.v.v.>.vvv.>>....>....>.>v.>.v......vv.v>....v.>v.v>...>>....>.>v.v..v..v..>>vv..>v..v>...>>>v.v
>....vvv.v....>......>..v...v.>.vv.>v.>.>..>..v..v..>>v.>>..>..>.vvv.v..>v>v..v...v.v>>.v.>..>..vv.v....v.>...>.>v>.v>v.v.vv>.vv>.vv..>v.>.
.>v...vv>v.>.>.>......v..>>vv.v..>>.......v..v.....>.v>.>v>v>v..v.>v.>.>.....vv>>vv.>.vv.v..>.v.v.>v.v.>....>.v.>>.v>....>.v....>..v.>>v.v.
.>.>>..v>.....>...vvv>>...>v.>>...>v.>..vv.>v>...v>>..v>..>vv.>..>.v.....>>v.>.>>>vv>..>..v.>>.>v.>>...v...>....vv...>v.vv>..v..v.>.>v>>>v.
v>vv.v>v>>>..vvv>v.v.>>>...>.....v>.v.>...v.v..>>.v>..>.v.v>>...v.>...v.>.....>..vv...vv..v>....v.>....>.v>>>>..v>vvv..>...>>.>.>>..>>>....
..vv>..v>...>v....v..>v.v....>.v...>>.>>..>vv...>...>>..>v>v.v....>.>>....>.v.>.v....v>..>.>vvv.>v....v>....v...>.>.v..>>v.v..>.vv.>vv....>
...v>>v..vvvvvv>..v...>vv>...>.......vv>>>>.v>.v>vvv.v...>.>>.v>v>v..v.v..v......v.>.v.>.v..v.v....>..>.>....>...v>...>vv.v>.>..>...>.v>>.v
v>..v.v>>.v.....>.vv..>..v..vv..vvvv>..>.>....vv.>..>vvvv>..>>.>...vv.>>..vv>>.>......vv>.vv..>v>>>.vv>v.>.>.>v....v>..>vv....>vv....vv..v.
.>.>..v>..v.>vv..vvv..>..vv.vv>v.>>..v.>vv>.>.>.vv.v.....>vvv.>.v>..>.>..>......vv>.....>..vvvv>.vv...v.>..v>v..vv..v>>>v>..v.v.v.v>....v.v
...v.>....>>>v>vv.>vv.v.>.v......>.vv.>..>.v..v>.v>vv>.>..vv....v.>vv>.....>....>>.v.v....v>>>>..vv>v..>..>>.vv..>..>vvv.>>.v..v>>.>>..vvv.
>.v..>v..vv>>.vv....>>.>v...vvv.....>>v..>.v.v.>vvvv..>...v...>.>..v.>>>...>v.....>.v..v.>.....v>vv..>>.>v>>v...vv...v>.....v.>.>.>..v.>>..
.>>.v.v..v>......vv.v.v>.>v....v...>.>>.>>.>.>.v>v..v.>..v..>.vv>>...v>.....>v..v...>.>.vvv.>..vv.v..v>vv....>.v..>.....vv.>....v>>...v..>>
v>>..v>....>..v.......v.>.v>.v..v>>>>....vv...vv>>>v.>..>....vv..>....>>>..v.v>>>vvvv...>..>vvv>v..>vv..v....v.v.>.>..v>v>.v..v.>.>..>v.vv>
>.>v..>v..vv>..>..>.v......v>.v>>>..>..v>v>..v..v.>.vv..v>.v>vv.>v.>v.v.>v..vv..vv>..v>.>..v>.v.>v.vv.>.v.>v.v..>..v>vvv>..v.>..>>....>vv.v
....>>.>.v.vv...vv>....>...v...v..>.>.>>.v.v>v.>>>.>>v.vv..>.>....>>...>v.>vvv...v.v.>......v.......>vv..v...v>>vv>.>.>...>>..>.v>v.v.v.v>>
>..vvvvv>v.v.v.vv.>>.vvv...v.v>v..v.......v..v.vv.v.vvv>v.v....vv..>..v.vv..v>.v.>.>.>.>..>v>..>......>....v..v>...v..>vv>v.>..>>>v>vvv.vv.
v.....>.>>vvv...>.>vv>.....v..>>>>vv..v.>.v...v..>v.>..v>vv>>v>.>.v>.>>.v.v..v..>v..vv.......>>.>vv.>.....>v.v>.vv.v.v.vv>..>.>.>>.>..>>vv.
..vv..>vv>.vvvv.v>>>>vvv...>v..>.v.v.vv.>.v>vv>>v....v..v..>>>..>..>.>>>v...>.>v>v>.>>v.vv...v>v.>.....v>>v>v..>..vvv>.>>>v.>...v>v.vvv..v.
v.v...v.>..v.vv>..>.>vv...>>>>>>v>.>..vv.v>vv..vv.v......v.>..v..>>vv...>v..>....>v>.>..>v..>v...>vv>....>v.>...>>vv.>>>>v>....>>.>..v..>.v
>.....>....>v.>>v...v...v......>.vv.v>.....v...>>v>.v.v.>.v..v.>>......v.v..>.>>.>v>.>>.>.v.v...v>..>.>.>v.vv>.>..>v.vvv..v.>.vvv..v>v>....
v.v..>....>.>...>..>.vv.v.>.>>..vv.>......>>>v.....>v..>.>..>v.v>>>v........vv.v.v>.>>v.vv>v.v.v..>.>.>>.vv..v..v>..vv....v..>>>vv>.>....vv
.v..>.vvv..v.>vv.vv.>..>.vvv>...vv>vvv..vvv>..v..v.v...>.>.vv.>..>......>vv>.v..>>..>.v..v>>v.>>...>..v.>>>v.vv>v.>...v>.>.v>vv.....v>.v>>>
......>.v>>....v.....v.>v>>..v.v..>vv.v>..>vvv...v...>v.>...>..>>.>.v>.....vv...v>v..vv..>v...v..vvv...v>v>..>...>vvv>>.v>.>.....>>..v.....
..>.v>.v.>.>>vv.....v....>>v......>.v.vvvv>...v.vv..>..>v.vv..>.v>vv..>....>..v>..>.vv.>>>v..v.>..v>.vv>..>.vvvv>v.v>vv>>.>.v..v.v.>v.>....
...>.v..>.>>..>.v...>vv>..>>>v..vv>.>....>v....v.v>v.>..vvv>>.v>vvv>.>.....v>.>>.>..>...>.vv.>.v>.v.v..>.>......>v..>.v..>v>>.v.>..v.v>vv.>
.>v...>v>>..v..v.>.>>.......>.v>>..vv.>..v.>....v>....>......v>v>..v...vvvv.>..v.v...>v.........>v>.......vv..v.v>>.v..v.v.v..>...v...v..>>
vv....v.v>>>.......vv..>..>>vv>>.vv>v...>>.v>>.>.....v.>.vv>>>..v>....>v>.......v.v.vvvv.>..vvvvvv..v..vv..v>>v......v.>....v>...>...v...>v
..>v.>.>...vv>vvv>.>v>.v..vv...v.v>v..v.v>..>v>>>v.>.v.>>.v>v.>v>vv...v.....v..>..>v..>v>..>.>...>...>.v..>>>>.>v>......>>..v.>v.vv.>...v..
..>>.>>v...>v>.>.v>>v...v.v..v.v.v.v.vvv>.v>v..vvvvv.v.>>>..v....>v...v>.vv>v>..>...>.>>....vvv.v>v.>vv>>.>v.vv...v..v>.v.v.>v.>...v...vv..
..>v.>.v...>v>...>>v.v...v.....v.v.v..>v...>v>v>.>>>>.v.>vv.>.vvv>.v....v...>>>v.vv..v>..v..>...v.v>...>.>v.v...>v>..>.>>>>.v....>v.vv..>.v
>v.>vv.>>>.>>...vv..v.v..>.>.>vv.v>.....>>.>>.>>.>..v...>v..>.v.v>.>vvv...>..v.vv.v...v..vv>v>.vv..>.v..vv.>...>.>>>>>.v.>...>.v..v>>v>..>.
.vv>..vvv...>..vv.>.>.....>v..>...v>.v.>v>.v.v>..>..v..v.vv>.vvvvv>vv>...v>..v>....>v.vvv.>vvvv>>..vv...>...>>vvvv>v>v.>>>.vv.v.>>>.>..>>..
>>v.v.vv...>>.>v>>..v.v.>>v>>..v.vvv>.v>..vv.>...>.vv>.>...v.v>.vv..v>.v..>>.>.>v>.>.vv.>vv>.v.v..v>.>.>v.v.>..v>.>v>vv......v>.v.v...v>v..
.v>vv>>.>v.vv.>...>>v>.v>>v>...v>v..>.vv..>....>..v.>vv>v...vv>..v.>.>.>vvv>.....vv.v>v.v.v.>>.v>>.>>>.>v>v.vvv..>v.vv>......>v.>..>.v..>.v
.v>vv...v.>.>..v>..>vv......v....v.....v>vv..v.v.>.....>>.vvvv.vvv.vv....>>>.v>vv..v.v..vv.>>...v.>...v>vv..vv.vv........vvvv.>v.v>>vv.v>v.
.>>...>.......>>>>.v..>v>>.>>v.v.>...v>....>>>..vv.>v.>>.>vv>>..>v.>v..>v..v.>>.>>>>.>.>vv.v.v>>....v>.>...>..>.>>>>>.vv>v.....vv.v...v>vv>
vv..v..........v......>.....>...v..vvv.....>...v.....>v>v.>....>..........v....>..>.v>.>>....>.v....>>..>v....>.v>..v....v...>v..>>.>>v.v..
.>v..>.>v>v>..>.v.>.>v..v>>.vv>..>>.>>.....v..>>.>....>.v...>vv>.....>>..>.v>..v.vv......v.>.v.>.v>>v..v...vv........>>>>..>vv..v.v.>>v>.>.
>..v>.>..vv>..v>...v.>...>...v....v..v..>..>.>v..>>..>v>..vv.>.....>.>..v..vv.>.>>..>...vv.vv>.>.....v.v.>>.v...>v.v>v>v>v>v>>v>v.vv..vv>v.
>..v>..>>.v>...v.v>.>.>.vvvv.>>v.v>vv>..v..>>...v..>.>v>.>>>..>...>...>>....>..vv.>.v>v>..v>.v.....vv.>..vvv..>vv>...>..v...>..>..v.>>>>.>>
.>>..>.v.>vv...>>...>.vvv>..>.v>.v.v.>>>.>vv..>vvvvv.v>vv...>.v>.v...v>........v.v.>.>v>.>v>..vv..vv....>>>v.>>..>..>.>...>...v.>..>..vv...
......v>..>.>..v.>vv>..>...v....>v..>.....vvv>.....v..>.v....>.v.>.v>.>.>...vv>.>.....vvvv...>...>>..>.v...v>v>..>.....v.v>v.v.v.v.>..v..>.
.v>.>v.>....v>.vv>vv.v....v.>>v.>.>>v.>>vv..>.>.....v...>v..>vv.vvv...v..v.v.....>..v.v.v.v.v.>.....v..v>......v>...>...v...v.>.v.>v>>..>..
v..>>.>vv>.v..>v..>.v>.>>.>..vv...>vv..>..v>...v..>.>.v>..>.>v.>>.>v....>.>...>..vv>.v..>..v..>>v.vvv>.>>>>v.v...>..>.v....>vv.>.v>vv>v>...
.v.v.>.>.>>.v....v.>.v......v..>v>>.>vv>.>....v.>...vv>>......v>......>......v.>>..>v.v..v.v>.v>>.v.v.v>......v..>v>.....>..>>.>......>vv>>
>>vv>.>>>.>..v.vv>v>>....v>vv..vv>....>..>..v.>>.>...>.>.v.v.v.v.....vvv.>.....v.v........v.>..v>.v..>...>.v.....vv...vv>v>...>>...vv...>>.
v>.v.>>...>..>..v>v...v...>>>v>..v>.v>....>..v>.v..v.>.>>..>v..>>>v>.>.>>.......>......>......v>..>v.v....>.v>>>v.>v.>..v..v.v.>vv.......>.
vvv...v>v......v.v.>....v>vv.v...v>.v>vv.vvv....>vvvv.>v>>.vv>.>..>.v>>.>....>v>..>>..>.>.>...vvv>.v>>v>.>>>>.>..v.v>>>vv.....v.>.>.>vv>>>.
>>.>..vvv.vvvv..v>>.>.>>.v>>..v.v..v>>>......>..v>...>.....v...v..v...>.v>>.>...v>>.v>v..>v..v.v.>>.>>v...v>>.>.>>v.........v...>....>>>.>.
v....>...>vv>..>...v.v>v>v..v.v.v>.>>.>.>>>....>..>vvv.>v..>>v..v.v..v.v>..>...vv>v..>.vv..v.>.v....vv....>v.>>>>>....>>>.>.>>v.v.>vv.>>...
>>...>vv.....>vv>...v....v>..v.v.>v>.>..vv>>...v>.>.>.......>.v..>.vv>....v.v.v.v.v..v.>...>>.v....vv..v>vv>.v>>.>.>..>..v..>..v.v>..>v.v.>
>>..v..vv>.>>>.>..v.>.v..>..>....>>v..vv..v.v>.v.>.....v..vv>.vv......>.>v>...>>..>..v..>v..v.>>v>v>...>.......v.>>.v>.>...>...>v>...v>.v>.
.>v>.>.>.>>>.>vv...vvv.v....>>vv..v...>>>.v>..v..vv.>....v.v.v..v.v>.>>v..>.v>..v.v>...v..v.....v.>vv>>>....v>v.v>>.....v>v.>.>...>..v.>.v.
>vv>....v.>vv.>..v.vv.v.....>...>vv.>.>..>.v....v..vv.vv>.v..v.>..v.v..vvvv.vv...v.>>>.>v..>v.>..v>v>..>v.>.....>.....vv.>.v.>.vv.>>>v.v.>.
....vv.>v>.vv>..vv.v....vv.....vvv....vvvv..v.....>....vv..>>..v>.>.v..v.......v>v.>..v..>>v>>vvvv....vv>...v.>...vvv.>...v>.....>v>..v>.v.
v>.>....>.v>.vv...>>....v.....>v...>.>>.>...>..v>...>>>>vvv>..v..v..v.>v.>..>.>>.vv>v..>vv..>.>v.vv..>>.......>>...>.>...>v>....>.v..vv>.>v
.v..vvv.....>.>.>.>v.....>.v..>v..v..v..vv>>>>.vv...>.>vv.>.>....>v.>........>>>.v.v.>v..>>.v>v.>v.>>.v...>...vv.>..>.vv>>>v.>.v..>.>......
v>..vvvv>>v>v>v..>>>vvv.v..>>....v...>....v..vv..>>.>vvvv.vvv>v...vv>...vv>v.>..v.>v...v>>.vv..v..v.>v..>..v..............v>v......>.v>....
>>>v..vv.>.v.v>>v..>.>v..v....>>>.vv>v.v.>..>.vv...>.>.....v...>.>...v>.v>v..vv...>v.v....vv.v>...v.>....>>vv>v.....v>.>>...>.....>...>..v.
.>.>v.v..>v.v>>..v..vv>>.v.>>>...>.>..v..>....>.>>>>..>>.>>......vv>.>>....v.v>.>.v.>..>..v>...vv>>........>..v>v.>v....>.>v..>v.v...>.>...
>v.v...v>>>v>...v..>..vv>.vv.>>.v..>v..>..>>vv>..>..v>>vv...v..>.v.>..>.vv..>vv.>...>vv....>>>v>..v.v.>.>..>v>...v.>.vv....v>>..v.>vv>...>.
..v.>vv>....v.v>vvv.vv>>.....>..v.>.>>..v>..vv.>v.>>.>>>.....v..v>.......vvv.>>.v..v>vv>>.>>v.v.v.v.>vv..vv....v.v....>.....vvv.vvvvvv..v>v
>.>..>>v..>..>v.>.>v....vv..>..>>.>>v.>..v>..v...v>v...>.>>v>v.>>>.>..v.>..v.v>>>v>>>>vv...>.v.>.v>.v...v.v.>...v.>v>...>...v.>.v.........v
>>>..>>...>>.v>vvv..v....v.v>.>..>.v>v.>.v.v>.>v>..v..v>v.vv>v.v>v>..vv...v.>v.>>...>.>>v...>.v>v..>v.v>>.vv.v.v...>.v...v...>v.>>>vv>>.v>.
.>vvv.>v...vvv....>...vvv.v..v.>>>.v>...v.>>.v..v.>....v.v>vv.>....>>.>v..v.vv>>..v>.v>.>>..>>..vv>>v.v...>.>v>v.v.>>.>vvv...v..>>...v..v..
..>v>..v.v..vv>>v.vvv.>.v.>v....>...>>v..v>>>>>.>vv>v...v....>..vv.>v>>>.>.>vvv....>v>>v.>>...>..v>>>..>.v>vv..>>.vv>.vv.>>.v....v>.v.v.>..
>>...>...v..>>.v>..>.v....>vv..>..>..>v..v.v>....>v..v.v.vv.v..vv.....>v>..>v>.>v>v...v..>vv..v...v..v..>.......>>>...v.>.v>.v.>>.>..v...>.
.....>.....vv.vvv.>v.vv.>>v>v.>>.>.>.v>..v>>.>>>...>....>vv.v..v...>.v>.>.....>.>.v..>..>>.vv..>v>v..vvv....v..>vv...v.>>v>........v..>v...
>v.>..v.....>.v.>..>.>..>vvvvv.>.>.>.>>v>v>v.v.vv>.v..>vv..>v>..>v.v...v>....vv......>.>vvvvv>..v>....>>.v.v>vv>>>...v>.>....>>>...>...>vv.
vv..>..vv>.v>...v>..v.>v.>>.>>>v...>...>vvv>v.v>>..>.>>..>>......v.....>>...v>.>...>.v>v>>..v>.>.>...vv.>>.v>...>>>.v>.vv...>...>..>.v.>..>
.>v.>>.......>v..>>v>v.>...>v.....v>.v....v>..v>.>>>.vv...v>..v>v>v..v.v..v>vv..>.>vv>..>v..>>.vvv>>vv.>.>>.>..v..v>.>.>>v>v>v.v.v.>..v....
.v.>v.>>...vv.>v>vv>.v>.....>>>.>>>>..v..v>..>..vvv>v>vv...v.>vv.>.v>.v..>v..vv>>.v.vv>vv...>...v..>v>.vv>..>v.>..v.v.>v....>>v.v.vv>.>.v..
.v....>>>.v....v>.v....>.>....>>..>...v.>.v>.>>.>.....>>...vv..vv..>>.vvv.>>v..v>v>.>.>..v.v>.vvv.v..v..v>vv..>>v.>>vv.....v.>....v..vv....
>.vv.vv>>v..>>v.v.>.>.v....v>..v.>...v.>.vv.>..>>v...>vv...>vv...>...vv>>vv.v>.>>>v...v.v..>.>..v>v....>..>v..>.v...>>v..v...>.>v>.>.>v....
.>>>...>v>.>vvv>..>......v....>.>>vv.v.v..v.>v.>v.......vvv.v..v>..>.>.>...>.>v.>...v>vv...v....vvv>>v>>>..v>.>>v>v.v.....>>...>vv>..>v....
.>...>.v>>v.>v>.v.>.v>v>>.v......v.>....v..>v.v>>>>v...vvv...>.vv.>v.>.>>.v....>v.>>>...>...>.v...>.vvvv.>..>.vv.>.>>vv...v>v..>v.>>.v.>..>
v..>v>>>>v.v>.......>.v.>v>>>.v>>vvv..v>...........v>.>>>>.........v...>..>.vv.>>...v.v>v..v>vv...>..>>..vv.>v.>..>v.v.>>.>.v>...v>.>v..>..
vv.>.vv.>...v..v.>.vv..v.>..vv.v......v>.vv..>.v>..>..>vv.vv..vv.>>vvv.>...v>..>...>.vv...vv..v.>....v........v>.>.>>>.v>>..v.v..>.v.....v.
.v>...>vv..v>>.vvv.vvv......>>vv.>v>..v>..>..>..vv.>>vv....>v....>.v.v.>vv....vvv>.v...>>.v..v>....>>.>>..>>>.v..v..>.>..v....>>v>..>.vv>>.
>..vv.vv..v.v..>>vvv...>.v>..>.>>..>>...>.>>.>>>v...>.v>v..>>>.>v>>>.>.vv>.>>>.v.>.v>..v..>>.>>.vv.v>>>>..vv..>v..vv...>.>.vv......v>>v..>.
..>>.v>>vv.v>..v...>v...>>....>....v.......v..>vv.....v>..>..vv.vv>>v.vv>vvv>v>>.v.>...v>.....v.v..v.v..vv>v>v.>>>v>..vv>>.vv>vv...v....v>>
..>..v....>.v..>.v..>...>.>..v.>.v>..vv.>...>>...v.....v>>.....v.v>...>..>...vv.v...vv>>v>v..vv.v.v..v>>.>v>>.vvvv..>.>>..>.v....v>.>vv..>v
>....>.>v>.v>.v..>.>...v.....v>..>>>v..>v.>>.>>....vvvv>..v..>.v>>.v.>...>.>..>.v>>.>.>...v.v....>vv..>>..v..>........v.v>v.>vvv.>v...>>>>>
v>.v>>>.....>......v.>.>...v.vvv.>v.....vv...>.>.v>vvvv.>.vv.vvvv.....v>v.>.vvvv>>.v...>vv>.>>>>v>.v.>.....vvv>..v.>>v...vv..v.v.v>v>>..v..
>.....>>..>v..v.>>>v.v>...>.v...>..>v..>>...v>>>.v.>vvv>>v.....>v.>.>v.>.>..>.vvv>v>..vv..v.>.>v>.v>.>.v.vvv..v.v>.>..>>...v...v>v......v..
vv..>>....v>v......>>vv.v.>...v....v.>vvv>.vv..v..>>>...v...vv...>>v...>v.......>>v.>...v.>..>v>>v>>..>.vvv....v.v...>.....>..>v.>.>v>.v>>>
..vv.v.>...v>>.v..>.>..>.vvv>...v...>.vv>.v>.>..>.v...vv>v.>.....>vv.>>.>.....vv.>.v>>>v.v>..>>>>..>>...v...v..v.>vv.>v>..>.v...v.v>v>v...v
.v....vv.>v..>........>v...>v.>v>>v..>..v>.v>>.>>.>.>v.v.v>...vv>v.>..vv.>v.v>vv>..>v..v.>..v>.v.v>.>....>..vv.>v..v>v.v..v>..vv.....>v..>.
>.>.>.>v>..vv>>>..vv>.>...>>>....>....v.v.>v.....>v.>....>.vv...vv.>>v..v..>.>..>v.vv.v>vvv.>..v.v>>.>.v...>>..v>v>.v.>.v>v.v.>>.v.v>>v...v
v..v...v....>.>..>..>>.v>.v..v....v..v.v.>>v...>..v>..v.>.vvv.>....v..>.v.>.>...>>>>.v>v>.v.v>v>.>...>....>v.v>>..v>.>.>>.....v>>vv..>..v.v
.vv.>>>..v>v..>>.v....vv.>v.....vv>>>v...vvv...>>vvv>v.>.v>>...vv..v>v.v...v>...v...>v>...vvv....vvv>.vv.v...>v.v......v>..>.....>v>v..>.v>
.v..>vvv.>>>>.>...>..>v.>.v...v.>v.v>>.v>v.>>v>..v>>v.....vv.>..>.>..v>...v..v.vv......>.>..v.>.>.vvv>v>..>.v.>>....>>>.>..v..>vv...vv>.>v.
..>..>.vv..v..v.>v......>>v>v>v.>......>>.>...>..v....>>>v>.>..v.v>.>....v>>...v.>v>.>v>..v>>>v.>.>>v..........v...>vv.>>....>>..vvv..v>..v
>>.v..v>...vv.>.>...v...>v..>..>..>.vv>>..v..>.v.>.>...v.v..>v.v..>..v.vv..>v>..v..>>>>..vv.v.vv>.....>>.......vv......>...vvv>>.v>v>.v..v.
.>v..v..vv..v.>.....v>vv.v>>.>.>...v...vv...v.>...>>>>.>..v.>>.>>>.v>....>.>..v..v>>.>..vv>.>>v.v>.....v>vv.v...v..vv>>v..>>vv..v...v.>v...
.v>>v.vv>...v>>....v.v..>v>..v.v.vv.vv...>.v>v..vv.>>v.>.v>..>>...>.>>..v..>.>..vv....v>>..vvv>v>v..>vv.>>..>.>.>>....v....v>..>v>>v..v.>.>"

IO.inspect(AOC25.solve(full_input))
